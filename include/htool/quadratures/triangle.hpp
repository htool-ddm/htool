#ifndef HTOOL_QUADRATURES_triangle_HPP
#define HTOOL_QUADRATURES_triangle_HPP

#include "quadrature.hpp"
#include <cstddef>
#include <string>
namespace htool {

template <typename T>
struct TriangleRule {
    inline static const std::string name = "triangle";
    std::size_t degree;
    std::size_t nb_points;
    const QuadPoint<T, 2> *quad_points;
};

// ---------- Degree 1 (1 point) ----------
// Centroid
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg1[] = {
    {{T(1.0) / T(3.0), T(1.0) / T(3.0)}, T(1)}};

// ---------- Degree 2 (3 points) ----------
// Hammer-Marlowe-Stroud
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg2[] = {
    {{T(1.0) / T(6.0), T(1.0) / T(6.0)}, T(1.0) / T(3.0)},
    {{T(2.0) / T(3.0), T(1.0) / T(6.0)}, T(1.0) / T(3.0)},
    {{T(1.0) / T(6.0), T(2.0) / T(3.0)}, T(1.0) / T(3.0)},
};

// ---------- Degree 3 (4 points) ----------
// Hammer-Marlowe-Stroud
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg3[] = {
    {{T(1.0) / T(3.0), T(1.0) / T(3.0)}, T(-9.0) / T(16.0)},
    {{T(0.2), T(0.2)}, T(25.0) / T(48.0)},
    {{T(0.6), T(0.2)}, T(25.0) / T(48.0)},
    {{T(0.2), T(0.6)}, T(25.0) / T(48.0)},
};

// ---------- Degree 4 (6 points) ----------
// Cowper
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg4[] = {
    {{T(0.445948490915965), T(0.108103018168070)}, T(0.223381589678011)},
    {{T(0.108103018168070), T(0.445948490915965)}, T(0.223381589678011)},
    {{T(0.445948490915965), T(0.445948490915965)}, T(0.223381589678011)},
    {{T(0.091576213509771), T(0.816847572980459)}, T(0.109951743655322)},
    {{T(0.816847572980459), T(0.091576213509771)}, T(0.109951743655322)},
    {{T(0.091576213509771), T(0.091576213509771)}, T(0.109951743655322)},
};

// ---------- Degree 5 (7 points) ----------
// Tabulated values from https://github.com/zmoitier/HAdaptiveIntegration.jl based on Laurie, 1982 https://doi.org/10.1145/355993.356001.
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg5[] = {
    {{T(1.0) / T(3.0), T(1.0) / T(3.0)}, T(9.0) / T(40.0)},
    {{T(0.7974269853530873223980252761697523438888496862182467453892927396298555325654265), T(0.1012865073234563388009873619151238280555751568908766273053536301850722337172867)}, T(0.1259391805448271525956839455001813336576392319122570076445103551949054307567196)},
    {{T(0.1012865073234563388009873619151238280555751568908766273053536301850722337172867), T(0.7974269853530873223980252761697523438888496862182467453892927396298555325654265)}, T(0.1259391805448271525956839455001813336576392319122570076445103551949054307567196)},
    {{T(0.1012865073234563388009873619151238280555751568908766273053536301850722337172867), T(0.1012865073234563388009873619151238280555751568908766273053536301850722337172867)}, T(0.1259391805448271525956839455001813336576392319122570076445103551949054307567196)},
    {{T(0.05971587178976982045911758097310479896829317092461039746785011751300161029171882), T(0.4701420641051150897704412095134476005158534145376948012660749412434991948541406)}, T(0.1323941527885061807376493878331519996756941014210763256888229781384279025766126)},
    {{T(0.4701420641051150897704412095134476005158534145376948012660749412434991948541406), T(0.05971587178976982045911758097310479896829317092461039746785011751300161029171882)}, T(0.1323941527885061807376493878331519996756941014210763256888229781384279025766126)},
    {{T(0.4701420641051150897704412095134476005158534145376948012660749412434991948541406), T(0.4701420641051150897704412095134476005158534145376948012660749412434991948541406)}, T(0.1323941527885061807376493878331519996756941014210763256888229781384279025766126)}};

// ---------- Degree 6 (12 points) ----------
// Cowper
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg6[] = {
    {{T(0.249286745170910), T(0.249286745170910)}, T(0.116786275726379)},
    {{T(0.249286745170910), T(0.501426509658179)}, T(0.116786275726379)},
    {{T(0.501426509658179), T(0.249286745170910)}, T(0.116786275726379)},
    {{T(0.063089014491502), T(0.063089014491502)}, T(0.050844906370207)},
    {{T(0.063089014491502), T(0.873821971016996)}, T(0.050844906370207)},
    {{T(0.873821971016996), T(0.063089014491502)}, T(0.050844906370207)},
    {{T(0.310352451033784), T(0.636502499121399)}, T(0.082851075618374)},
    {{T(0.636502499121399), T(0.053145049844817)}, T(0.082851075618374)},
    {{T(0.053145049844817), T(0.310352451033784)}, T(0.082851075618374)},
    {{T(0.636502499121399), T(0.310352451033784)}, T(0.082851075618374)},
    {{T(0.310352451033784), T(0.053145049844817)}, T(0.082851075618374)},
    {{T(0.053145049844817), T(0.636502499121399)}, T(0.082851075618374)},
};

// ---------- Degree 7 (13 points) ----------
// Cowper
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg7[] = {
    {{T(1.0) / T(3.0), T(1.0) / T(3.0)}, T(-0.149570044467682)},
    {{T(0.260345966079040), T(0.260345966079040)}, T(0.175615257433204)},
    {{T(0.260345966079040), T(0.479308067841920)}, T(0.175615257433204)},
    {{T(0.479308067841920), T(0.260345966079040)}, T(0.175615257433204)},
    {{T(0.065130102902216), T(0.065130102902216)}, T(0.053347235608839)},
    {{T(0.065130102902216), T(0.869739794195568)}, T(0.053347235608839)},
    {{T(0.869739794195568), T(0.065130102902216)}, T(0.053347235608839)},
    {{T(0.312865496004874), T(0.638444188569810)}, T(0.077113760890257)},
    {{T(0.638444188569810), T(0.048690315425316)}, T(0.077113760890257)},
    {{T(0.048690315425316), T(0.312865496004874)}, T(0.077113760890257)},
    {{T(0.638444188569810), T(0.312865496004874)}, T(0.077113760890257)},
    {{T(0.312865496004874), T(0.048690315425316)}, T(0.077113760890257)},
    {{T(0.048690315425316), T(0.638444188569810)}, T(0.077113760890257)},
};

// ---------- Degree 8 (16 points) ----------
template <typename T>
constexpr QuadPoint<T, 2> triangle_deg8[] = {
    {{T(1.0) / T(3.0), T(1.0) / T(3.0)}, T(0.144315607677787)},
    {{T(0.459292588292723), T(0.459292588292723)}, T(0.095091634267285)},
    {{T(0.459292588292723), T(0.081414823414554)}, T(0.095091634267285)},
    {{T(0.081414823414554), T(0.459292588292723)}, T(0.095091634267285)},
    {{T(0.170569307751760), T(0.170569307751760)}, T(0.103217370534718)},
    {{T(0.170569307751760), T(0.658861384496480)}, T(0.103217370534718)},
    {{T(0.658861384496480), T(0.170569307751760)}, T(0.103217370534718)},
    {{T(0.050547228317031), T(0.050547228317031)}, T(0.032458497623198)},
    {{T(0.050547228317031), T(0.898905543365938)}, T(0.032458497623198)},
    {{T(0.898905543365938), T(0.050547228317031)}, T(0.032458497623198)},
    {{T(0.263112829634638), T(0.728492392955404)}, T(0.027230314174435)},
    {{T(0.728492392955404), T(0.008394777409958)}, T(0.027230314174435)},
    {{T(0.008394777409958), T(0.263112829634638)}, T(0.027230314174435)},
    {{T(0.728492392955404), T(0.263112829634638)}, T(0.027230314174435)},
    {{T(0.263112829634638), T(0.008394777409958)}, T(0.027230314174435)},
    {{T(0.008394777409958), T(0.728492392955404)}, T(0.027230314174435)},
};

template <typename T>
constexpr std::array<TriangleRule<T>, 7> triangle_rules = {{
    {1, 1, triangle_deg1<T>},
    {2, 3, triangle_deg2<T>},
    {3, 4, triangle_deg3<T>},
    {4, 6, triangle_deg4<T>},
    {5, 7, triangle_deg5<T>},
    {6, 12, triangle_deg6<T>},
    {7, 13, triangle_deg7<T>},
    // {8, 16, triangle_deg8<T>},
    // {9, 19, triangle_deg9<T>},
    // {10, 25, triangle_deg10<T>},
    // {11, 27, triangle_deg11},
    // {12, 33, triangle_deg12},
    // {13, 37, triangle_deg13},
    // {14, 42, triangle_deg14},
    // {15, 48, triangle_deg15},
    // {16, 52, triangle_deg16},
    // {17, 61, triangle_deg17},
    // {18, 70, triangle_deg18},
    // {19, 73, triangle_deg19},
    // {20, 79, triangle_deg20}
}};

} // namespace htool
#endif
